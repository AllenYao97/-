5. DNS 域名解析系统  Domain Name System
  5.1 DNS的必要性：

        IP地址标示主机、路由器
        IP地址不好记忆，不便人类使用（纯数字没有意义）
        人一般倾向使用一些有意义的字符来标识Internet上的设备
        存在着字符串=====》IP地址的转换的必要性
       
        人类用户提供要访问机器的字符串名称====>DNS负责转换成为二进制的网络地址

  5.2 DNS系统需要解决的问题：

        如何命名设备：
          用有意义的字符串：好记，便于人类使用
          解决一个平面命名的重名问题：层次化命名
        如何完成名字到IP地址的转换
          分布式的数据库维护和响应名字查询
        如何维护：增加或删除一个域，需要在域名系统中做哪些工作？

  5.3 DNS的历史

        ARPAnet的名字解析解决方案：
          主机名：没有层次的一个字符串（一个平面）
          存在着一个（集中）维护站：维护者一张主机名-IP地址的映射文件：Hosts.txt
          每台主机定时从维护站取文件       

          问题：
            当网络中主机数量很大时：
              没有层次的主机名称很难分配，即很容易重名
              文件的管理、发布、查找都很麻烦
        
        解决--->:
          主要思路：
            分层的、基于域的命名机制
            若干分布式的数据库完成名字到IP的转换
            运行在UDP之上端口号为53的应用服务
            核心的Internet功能，但以应用层协议实现
              在网络边缘处理复杂性
          主要目的：
            实现主机名-IP地址的转换
            其他目的：
              主机别名到规范名字的转换：host aliasing
                别名：一般指域名，一个域名下一般不仅仅只有一台服务器     指一堆服务器对外的名字，便于用户的访问
                规范名字：某地区某机房某机柜某个刀片服务器---->         指对内的名字
                  根据规范名字可以实现服务器的负载均衡
              邮件服务器别名到邮件服务器的正规名字的转换：Mail server aliasing
              负载均衡：load distribution

  5.4 DNS的命名空间 Q1

        DNS域名结构：
          一个层面命名设备会有很多重名
          DNS采用层次梳妆结构的命名方法
          Internet根被划为几百个顶级域（top lever domains）
            通用的：generic
              .com .edu .gov .int .mil .net .org .firm .hsop .web .arts .rec
            国家的：
              .cn .us .nl .jp
            每个（子）域下面可划分若干子域（subdomains）
            树叶是主机        
            根名字服务器：
              逻辑上13台根服务器，实际上有很多物理根服务器
              中国没有
            可靠：
              如果某个根服务器宕机了直接换一个根  

        域名：
          从本域往上，直到树根
          中间使用"."间隔不同的级别
            例如：ustc.edu.cn  auto.ustc.edu.cn
          域的域名:可以用于表示一个域
          主机的域名：一个域上的一个主机

        域名的管理
          一个域管理其下的子域：
            .jp划分为 ac.jp co.jp
            .cn被划分为 edu.cn com.cn

        域与物理网络无关：
          域遵从组织界限，而不是物理网络
            一个域的主机可以不在一个网络
            一个网络的主机不一定在一个域
          域的划分是逻辑的，而不是物理的
    
    5.5 解析问题-名字服务器 Q2
          一个名字服务器的问题：
            可靠性：单点故障
            扩展性：通信容量
            维护问题：原距离的集中式数据库

          区域：zone
            区域的划分有区域管理者自己决定
            将DNS名字控件划分为互不相交的区域，每个区域都是树的一部分
            名字服务器：
              每个区域都有一个名字服务器：维护着它所管辖区域的权威信息（authoritative revord）
                权威DNS服务器：
                  组织机构的DNS服务器，提供组织机构服务器（如web和Mail）可访问的主机和IP之间的映射
                  组织机构可以选择实现自己维护或由某个服务器提供商来维护
              名字服务器允许被放置在区域之外，以保障可靠性   

          TDL（顶级域）服务器：负责顶级域名（如com，org，net，edu和gov）和所有国家级的顶级域名（如cn,uk,fr,ca,jp）
            Network solutions公司维护com TLD服务器
            Educause公司维护edu TLD服务器

          区域名字服务器维护资源记录：
            资源记录：
              作用：维护域名-IP地址（其他）的映射关系
              位置：Name Server的分布式数据库中
            RR格式：
              Domain_name:域名
              Ttl:time to live:生存时间（权威，缓冲记录）    决定了资源记录应当从缓存中删除的时间
                权威记录：无限大
                缓冲记录：默认2天  为了一致性
              class类别：对于Internet，值为IN
              Value值：可以是数字，域名或者ASCII串
              Type类别：资源记录的一个类型
                Type=A
                  Name为主机
                  Value为IP地址
                Type=NS
                  Name为域名
                  Value为该域名的权威服务器的域名
                Type=CNAME
                  Name为规范名字的别名
                    例:www.ibm.com的规范名字为servereast.backup2.ibm.com
                  value为规范名字
                Type=MX
                  Value为name对应的邮件服务器的名字

    5.6 DNS大致工作原理
          应用调用 解析器 resolver
          解析器作为用户 向 Name Server发出查询报文（封装在UDP段中）
            Name Server 一般指local name server 距离你最近的域名服务器
          Name Server返回响应报文（Name/IP）    

          Name Server名字服务器：
            名字解析过程；
              目标名字在local Name Server中：
                情况1：查询的名字在该区域内部
                情况2：缓存

            当与本地名字服务器不能解析名字时，联系根名字服务器，顺着跟-TLD一直找到权威名字服务器    

            递归查询：
              名字解析复旦都放在当前联络的名字服务器上
              问题：根服务器的负担太重
              解决:迭代查询
            迭代查询：  
              根（及各级域名）服务器返回的不是查询结果，而是下一个NS的地址
              最后由权威名字服务器给出解析结果
              当前联络的服务器给出可以联系的服务器的名字
    5.7 DNS协议、报文
          DNS协议：查询和响应报文的报文格式相同
          报文首部：
            标识符（ID）：16位
            flags：查询/应答
                   希望递归
                   递归可用
                   应答为权威           

            
           
