7. CDN content distribution networks
  7.1 视频流化服务和CDN: 上下文

        视频流量：占据着互联网大部分的带宽
          Netflix，Youtube：占据37%，16%的ISP下行流量
          ~1B YouTube用户，
          ~75M Netflix用户
        挑战：规模性-如何服务 ~1B用户？
          单个超级服务器无法提供服务
        挑战：异构型
          不同用户拥有不同的能力（例如：有线接入和移动用户：带宽丰富和受限用户）
        解决方案：分布式的，应用层面的基础设施

        多媒体：视频
          视频：固定速度显示的图像序列
            e.g. 24 images/sec
          网络视频特点：
            高码率：>10x于音频，高的网络带宽需求
            可以被压缩
            90%以上的网络流量是视频
          数字化图像：像素的阵列
            每个像素被若干bits表示
          编码：使用图像内和图像间的冗余来降低编码的比特数
            空间冗余（图像内）
              空间编码例子：不是发送N个相同的颜色（ 全是紫色）值，仅发送2个值：颜色和重复的个数N
            时间冗余（相邻的图像间）
              时间编码例子：不是发送第i+1帧的全部编码，而仅发送和第i帧差别的地方

            CBR:constant bit rate：以固定速率编码
            VBR:variable bit rate：视频编码速率随时间的变化而变化

            例子：  MPEG1(CD-ROM) 1.5 Mbps
                    MPEG2(DVD) 3-6 Mbps
                    MPEG3(often used in Internet，<1 Mbps)
                    AVS

          存储视频的流化服务：streaming
            边下边播（缓冲区）
            DASH:Dynamic，Adaptive Streaming over HTTP
              服务器：
                将视频文件分割成多个块
                每个块独立存储，编码与不同码率（8-10种）
                告示文件（manifest file）：提供不同块不同码率的URL
              客户端:
                先获取告示文件
                周期性地测量服务器到客户端的带宽
                查询告示文件，在某一个时刻请求一个块，HTTP头部指定字节范围
                  如果带宽足够，选择最大码率的视频块
                  会话中的不同时刻，可以切换请求不同的编码块（取决于当时的可用带宽与客户端的需求）
                智能客户端：客户端自适应决定
                  什么时候去请求块（不至于缓存挨饿，或者溢出）
                  请求什么编码速率的视频块（当带宽够用时，请求高质量的视频块）
                  哪里去请求块（可以向离自己最近的服务器发送URL,或者向高可用带宽的服务器请求）

  7.2挑战：服务器如何通过网络向上百万用户同时流化视频内容（上百万视频内容）

        选择1：单个的、大的超级服务中心"mega-server"
          服务器到客户端路径上 跳数 较多，瓶颈链路的带宽小导致停顿
          二八规律 决定了网络同事充斥着同一个视频的多个拷贝，效率低（付费高，带宽浪费，效果差）
          单点故障点，性能瓶颈
          周边网络的拥塞
          评述：相当简单，但是这个方法不可扩展
        
        选择2：通过CDN,全网部署缓存节点，存储服务内容，就近为用户提供服务，提高用户体验
          enter deep：将CDN服务器深入到许多接入网
            更接近用户，数量多，离用户近，管理困难
            Akamai，1700个位置
          bring home：部署在少数（10个左右）关键位置，如将服务器簇安装在POP附近（离若干1st ISP POP较近）
            采用租用线路将服务器簇连接起来
            Limelight       

          用户通过域名解析重定向访问CDN的缓存

  7.3 CDN

    CDN:在CDN节点中存储内容的多个拷贝
        e.g. Netflix stores copies of MadMen
    用户从CDN中请求内容
      重定向到最近的拷贝，请求内容

    CDN运营：over the top
      在应用层，在网络的边缘去加速内容。     （按理说，内容加速服务应该是在网络核心去解决）
      互联网络主机-主机之间的通信作为一种服务向用户提供

    OTT 挑战：在拥塞的互联网上复制内容：
      从哪个CDN节点获取内容
      用户在网络拥塞时的行为
      在那些CDN节点中存储什么内容

    
